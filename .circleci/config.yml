version: 2.1

jobs:
  build:
    docker:
      - image: circleci/python:3.10
    steps:
      - checkout
      - run:
          name: Install Conda & Dependencies
          command: |
            sudo apt update
            sudo apt install -y libboost-all-dev
            wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
            bash miniconda.sh -b -p $HOME/miniconda
            echo 'export PATH="$HOME/miniconda/bin:$PATH"' >> ~/.bashrc
            source ~/.bashrc
      - run:
          name: Verify Conda Installation
          command: |
            source $HOME/miniconda/etc/profile.d/conda.sh
            export PATH="$HOME/miniconda/bin:$PATH"
            echo "PATH: $PATH"
            conda --version
            which conda
      - run:
          name: Install `conda-build`
          command: |
            source $HOME/miniconda/etc/profile.d/conda.sh
            export PATH="$HOME/miniconda/bin:$PATH"
            conda install -n base -c conda-forge conda-build -y
            conda info --envs  # Verify environment setup
            conda list | grep conda-build  # Confirm conda-build installation
      - run:
          name: Build Stim Package
          command: |
            source $HOME/miniconda/etc/profile.d/conda.sh
            export PATH="$HOME/miniconda/bin:$PATH"
            conda build recipe/

workflows:
  version: 2
  build_and_test:
    jobs:
      - build

