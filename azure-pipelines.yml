# -*- mode: yaml -*-
# Generated by conda-smithy, with necessary adjustments

stages:
- stage: Check
  jobs:
    - job: SkipCheck
      displayName: "Check if CI should be skipped"
      pool:
        vmImage: 'ubuntu-22.04'
      steps:
        - checkout: self
          fetchDepth: 2

        - bash: |
            git_log=$(git log --max-count=1 --skip=1 --pretty=format:"%B" | tr "\n" " ")
            echo "##vso[task.setvariable variable=log]$git_log"
            echo "Commit message: $git_log"
          displayName: "Read previous commit message"

        - bash: |
            skip=false
            echo "Checking commit message for skip keywords..."
            if [[ "$log" == *"[skip ci]"* || "$log" == *"[ci skip]"* || "$log" == *"[skip azp]"* || "$log" == *"[azp skip]"* ]]; then
              skip=true
            fi
            echo "##vso[task.setvariable variable=start_main;isOutput=true]${skip}"
          name: result
          displayName: "Set skip flag"

- stage: Build
  dependsOn: Check
  condition: eq(dependencies.Check.outputs['SkipCheck.result.start_main'], 'false')
  jobs:
    - template: ./.azure-pipelines/azure-pipelines-osx.yml
    - template: ./.azure-pipelines/azure-pipelines-win.yml
    - template: ./.azure-pipelines/azure-pipelines-linux.yml
